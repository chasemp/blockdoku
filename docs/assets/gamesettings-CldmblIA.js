import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css             *//* empty css             */import{D as h,_ as p}from"./difficulty-settings-manager-Cn-lu4xS.js";import{G as y,C as b}from"./confirmation-dialog-CE0X1pfx.js";class g{constructor(){this.storage=new y,this.difficultySettings=new h(this.storage),this.settings=this.storage.loadSettings(),this.currentDifficulty=this.settings.difficulty||"normal",this.confirmationDialog=new b,this.init()}init(){this.loadSettings(),this.setupEventListeners(),this.setupResetListeners(),this.setupCrossPageCommunication(),this.updateUI()}loadSettings(){const t=this.storage.loadSettings();this.currentDifficulty=t.difficulty||"normal";const i=this.difficultySettings.getSettingsForDifficulty(this.currentDifficulty);this.settings={...t,...i},this.loadComboDisplaySettings(),this.loadGameModesSettings(),this.loadBasicSettings(),this.loadAnimationSettings(),this.loadAdditionalSettings(),this.loadUtilityBarSettings()}loadComboDisplaySettings(){const t=this.settings.comboDisplayMode||"cumulative",i=document.getElementById("combo-streak"),e=document.getElementById("combo-cumulative");i&&e&&(t==="streak"?i.checked=!0:e.checked=!0)}loadGameModesSettings(){const t=document.getElementById("enable-petrification");t&&(t.checked=this.settings.enablePetrification===!0);const i=document.getElementById("enable-dead-pixels"),e=document.getElementById("dead-pixels-intensity"),n=document.getElementById("dead-pixels-intensity-value"),s=document.getElementById("dead-pixels-intensity-container");if(i&&(i.checked=this.settings.enableDeadPixels===!0,s&&(s.style.display=this.settings.enableDeadPixels?"block":"none")),e&&n){const m=this.settings.deadPixelsIntensity||0;e.value=m,n.textContent=m}const a=document.getElementById("enable-wild-blocks");a&&(a.checked=this.settings.enableWildBlocks===!0);const d=this.settings.speedMode||"ignored",o=document.getElementById("speed-mode-bonus"),c=document.getElementById("speed-mode-punishment"),l=document.getElementById("speed-mode-ignored");o&&c&&l&&(d==="punishment"?c.checked=!0:d==="ignored"?l.checked=!0:o.checked=!0);const u=this.settings.speedDisplayMode||"timer",r=document.getElementById("speed-display-timer"),f=document.getElementById("speed-display-points");r&&f&&(u==="points"?f.checked=!0:r.checked=!0)}loadBasicSettings(){const t=document.getElementById("sound-enabled");t&&(t.checked=this.settings.soundEnabled===!0);const i=document.getElementById("animations-enabled");i&&(i.checked=this.settings.animationsEnabled!==!1);const e=document.getElementById("piece-timeout-enabled");e&&(e.checked=this.settings.pieceTimeoutEnabled===!0)}loadAnimationSettings(){["block-hover-effects","block-selection-glow","block-entrance-animations","block-placement-animations","line-clear-animations","score-animations","combo-animations","particle-effects"].forEach(n=>{const s=document.getElementById(n);s&&(s.checked=this.settings[n]!==!1)});const i=this.settings.animationSpeed||"normal",e=document.getElementById(`animation-speed-${i}`);e&&(e.checked=!0)}loadAdditionalSettings(){[{id:"haptic-enabled",key:"hapticEnabled"},{id:"auto-save",key:"autoSave"},{id:"show-points",key:"showPoints"},{id:"show-placement-points",key:"showPlacementPoints"},{id:"enable-prize-recognition",key:"enablePrizeRecognition"},{id:"success-mode-enabled",key:"successModeEnabled"}].forEach(({id:i,key:e})=>{const n=document.getElementById(i);n&&(n.checked=this.settings[e]===!0)})}loadUtilityBarSettings(){[{id:"enable-hints",key:"enableHints"},{id:"enable-timer",key:"enableTimer"},{id:"show-personal-bests",key:"showPersonalBests"},{id:"show-speed-timer",key:"showSpeedTimer"}].forEach(({id:a,key:d})=>{const o=document.getElementById(a);o&&(o.checked=this.settings[d]===!0)});const i=document.getElementById("enable-timer"),e=document.getElementById("countdown-duration"),n=document.getElementById("countdown-duration-value"),s=document.getElementById("countdown-duration-container");if(i&&s&&(s.style.display=this.settings.enableTimer?"block":"none"),e&&n){const a=this.settings.countdownDuration||3;e.value=a,n.textContent=`${a}:00`}}setupEventListeners(){this.setupDifficultyListeners(),this.setupComboDisplayListeners(),this.setupGameModesListeners(),this.setupBasicSettingsListeners(),this.setupAnimationListeners(),this.setupAdditionalSettingsListeners(),this.setupUtilityBarListeners(),this.setupResetStatisticsListener()}setupDifficultyListeners(){document.querySelectorAll(".difficulty-option").forEach(i=>{i.addEventListener("click",async e=>{e.preventDefault();const n=i.dataset.difficulty;if(n===this.currentDifficulty)return;console.log(`üéÆ Game Settings: Changing difficulty to ${n.toUpperCase()}`),this.currentDifficulty=n,this.settings.difficulty=n;const s=this.difficultySettings.getSettingsForDifficulty(n);Object.assign(this.settings,s),this.storage.saveSettings(this.settings),this.updateDifficultySelection(),this.loadSettings(),this.updateUI(),window.postMessage({type:"difficultyChanged",difficulty:n},"*")})})}updateDifficultySelection(){document.querySelectorAll(".difficulty-option").forEach(i=>{const e=i.dataset.difficulty;e===this.currentDifficulty?i.classList.add("selected"):i.classList.remove("selected"),this.updateDifficultyDescription(i,e)})}updateDifficultyDescription(t,i){const e=t.querySelector("p");e&&(this.difficultyManager?this.renderDifficultyWithBubbles(e,i):p(()=>import("./difficulty-manager-CR4JtsMm.js"),[],import.meta.url).then(n=>{const s=n.DifficultyManager;this.difficultyManager=new s,this.renderDifficultyWithBubbles(e,i)}).catch(n=>{console.warn("Could not load difficulty manager for descriptions:",n)}))}renderDifficultyWithBubbles(t,i){const e=this.difficultyManager.difficultySettings[i],n=e?e.shortDescription:"",s=this.difficultyManager.getComparisonBubbles(i,this.difficultySettings);let a=`<span class="difficulty-short-desc">${n}</span>`;s.length>0&&(a+='<div class="difficulty-bubbles">',s.forEach(d=>{const o=d.type==="enabled"?"bubble-enabled":"bubble-disabled";a+=`<span class="difficulty-bubble ${o}">${d.emoji} ${d.label}</span>`}),a+="</div>"),t.innerHTML=a}setupComboDisplayListeners(){const t=document.getElementById("combo-streak"),i=document.getElementById("combo-cumulative");t&&t.addEventListener("change",()=>{t.checked&&this.saveSetting("comboDisplayMode","streak")}),i&&i.addEventListener("change",()=>{i.checked&&this.saveSetting("comboDisplayMode","cumulative")})}setupGameModesListeners(){const t=document.getElementById("enable-petrification");t&&t.addEventListener("change",()=>{this.saveSetting("enablePetrification",t.checked)});const i=document.getElementById("enable-dead-pixels"),e=document.getElementById("dead-pixels-intensity"),n=document.getElementById("dead-pixels-intensity-container");i&&i.addEventListener("change",()=>{this.saveSetting("enableDeadPixels",i.checked),n&&(n.style.display=i.checked?"block":"none")}),e&&e.addEventListener("input",()=>{const u=parseInt(e.value);this.saveSetting("deadPixelsIntensity",u);const r=document.getElementById("dead-pixels-intensity-value");r&&(r.textContent=u)});const s=document.getElementById("enable-wild-blocks");s&&s.addEventListener("change",()=>{this.saveSetting("enableWildBlocks",s.checked)});const a=document.getElementById("speed-mode-bonus"),d=document.getElementById("speed-mode-punishment"),o=document.getElementById("speed-mode-ignored");a&&a.addEventListener("change",()=>{a.checked&&this.saveSetting("speedMode","bonus")}),d&&d.addEventListener("change",()=>{d.checked&&this.saveSetting("speedMode","punishment")}),o&&o.addEventListener("change",()=>{o.checked&&this.saveSetting("speedMode","ignored")});const c=document.getElementById("speed-display-timer"),l=document.getElementById("speed-display-points");c&&c.addEventListener("change",()=>{c.checked&&this.saveSetting("speedDisplayMode","timer")}),l&&l.addEventListener("change",()=>{l.checked&&this.saveSetting("speedDisplayMode","points")})}setupBasicSettingsListeners(){const t=document.getElementById("sound-enabled");t&&t.addEventListener("change",()=>{this.saveSetting("soundEnabled",t.checked)});const i=document.getElementById("animations-enabled");i&&i.addEventListener("change",()=>{this.saveSetting("animationsEnabled",i.checked)});const e=document.getElementById("piece-timeout-enabled");e&&e.addEventListener("change",()=>{this.saveSetting("pieceTimeoutEnabled",e.checked)})}setupAnimationListeners(){["block-hover-effects","block-selection-glow","block-entrance-animations","block-placement-animations","line-clear-animations","score-animations","combo-animations","particle-effects"].forEach(e=>{const n=document.getElementById(e);n&&n.addEventListener("change",()=>{this.saveSetting(e,n.checked)})}),document.querySelectorAll('input[name="animation-speed"]').forEach(e=>{e.addEventListener("change",()=>{e.checked&&this.saveSetting("animationSpeed",e.value)})})}setupAdditionalSettingsListeners(){[{id:"haptic-enabled",key:"hapticEnabled"},{id:"auto-save",key:"autoSave"},{id:"show-points",key:"showPoints"},{id:"show-placement-points",key:"showPlacementPoints"},{id:"enable-prize-recognition",key:"enablePrizeRecognition"},{id:"success-mode-enabled",key:"successModeEnabled"}].forEach(({id:i,key:e})=>{const n=document.getElementById(i);n&&n.addEventListener("change",()=>{this.saveSetting(e,n.checked),i==="show-points"&&this.updateBlockPointsDisplay()})})}setupUtilityBarListeners(){[{id:"enable-hints",key:"enableHints"},{id:"enable-timer",key:"enableTimer"},{id:"show-personal-bests",key:"showPersonalBests"},{id:"show-speed-timer",key:"showSpeedTimer"}].forEach(({id:e,key:n})=>{const s=document.getElementById(e);s&&s.addEventListener("change",async()=>{if(e==="enable-timer"){const a=this.settings[n]===!0,d=s.checked;if(a!==d&&this.isGameInProgress()){const c=d?"enabling":"disabling";if(!await this.confirmationDialog.show(`‚ö†Ô∏è Countdown Timer Change

${c==="enabling"?"Enabling":"Disabling"} the countdown timer mid-game will reset your current score to 0.

This ensures fair scoring since the countdown timer affects the game's difficulty and scoring system.

Do you want to continue?`)){s.checked=a;return}this.resetCurrentGameScore()}this.saveSetting(n,s.checked);const o=document.getElementById("countdown-duration-container");o&&(o.style.display=s.checked?"block":"none")}else this.saveSetting(n,s.checked)})});const i=document.getElementById("countdown-duration");i&&i.addEventListener("input",async()=>{const e=parseInt(i.value),n=this.settings.countdownDuration||3;if(e!==n&&this.isGameInProgress()&&this.settings.enableTimer){if(!await this.confirmationDialog.show(`‚ö†Ô∏è Countdown Duration Change

Changing the countdown duration mid-game will reset your current score to 0.

This ensures fair scoring since the countdown timer affects the game's difficulty and scoring system.

Do you want to continue?`)){i.value=n;return}this.resetCurrentGameScore()}this.saveSetting("countdownDuration",e);const s=document.getElementById("countdown-duration-value");s&&(s.textContent=`${e}:00`)})}setupResetStatisticsListener(){const t=document.getElementById("reset-stats");t&&t.addEventListener("click",async()=>{await this.confirmationDialog.show(`‚ö†Ô∏è PERMANENT DATA LOSS WARNING ‚ö†Ô∏è

This will permanently delete ALL your game data:
‚Ä¢ All high scores for all difficulty levels
‚Ä¢ All game statistics (games played, totals, combos)
‚Ä¢ All personal best records
‚Ä¢ All play time data

Your game settings and preferences will NOT be affected.

This action CANNOT be undone. Are you absolutely sure you want to continue?`)&&this.resetStatistics()})}setupCrossPageCommunication(){window.addEventListener("storage",t=>{(t.key==="blockdoku-settings"||t.key==="blockdoku_settings")&&(console.log("Settings changed in another page, reloading..."),this.settings=this.storage.loadSettings(),this.loadSettings(),this.updateUI())}),window.addEventListener("settingsChanged",t=>{console.log("Settings changed in same page, updating..."),this.settings=this.storage.loadSettings(),this.loadSettings(),this.updateUI()})}saveSetting(t,i){["enableHints","showPoints","enableTimer","enablePetrification","enableDeadPixels","showPersonalBests","showSpeedTimer","speedMode","animationsEnabled","soundEnabled","enableWildBlocks"].includes(t)?(this.difficultySettings.saveSettingOverride(this.currentDifficulty,t,i),console.log(`Difficulty-specific setting saved: ${t} = ${i} for ${this.currentDifficulty}`)):(this.settings[t]=i,this.storage.saveSettings(this.settings),console.log(`Global setting saved: ${t} = ${i}`)),this.settings[t]=i,window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{key:t,value:i}})),this.updateDifficultyBubbles(),this.updateSettingStateBubbles()}updateDifficultyBubbles(){document.querySelectorAll(".difficulty-option").forEach(i=>{const e=i.dataset.difficulty;this.updateDifficultyDescription(i,e)}),this.updateIndividualSettingBubbles()}updateIndividualSettingBubbles(){document.querySelectorAll(".individual-setting-bubble").forEach(t=>{t.remove()})}getSettingKeyForBubble(t,i){return{Hints:"enableHints",Points:"showPoints",Timer:"enableTimer",Best:"showPersonalBests",Speed:"showSpeedTimer",Prizes:"enablePrizeRecognition",Timeout:"pieceTimeoutEnabled"}[t]}addBubbleToSetting(t,i){const e=t.closest(".setting-item");if(!e)return;const n=document.createElement("div");n.className=`individual-setting-bubble difficulty-bubble ${i.type==="enabled"?"bubble-enabled":"bubble-disabled"}`,n.innerHTML=`${i.emoji} ${i.label}`,n.style.marginBottom="0.5rem",n.style.alignSelf="flex-start",e.insertBefore(n,e.firstChild)}addBubbleToSection(t,i){const e=t.querySelector(".individual-setting-bubble");e&&e.remove();const n=document.createElement("div");n.className=`individual-setting-bubble difficulty-bubble ${i.type==="enabled"?"bubble-enabled":"bubble-disabled"}`,n.innerHTML=`${i.emoji} ${i.label}`,n.style.marginBottom="1rem",n.style.alignSelf="flex-start";const s=t.querySelector("h3");s&&s.insertAdjacentElement("afterend",n)}resetStatistics(){this.storage.clearStatistics(),this.storage.clearHighScores(),this.showNotification("All statistics and high scores have been permanently deleted")}showNotification(t){const i=document.createElement("div");i.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            z-index: 1000;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `,i.textContent=t,document.body.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},3e3)}updateUI(){this.loadSettings(),this.updateDifficultySelection(),setTimeout(()=>{this.updateIndividualSettingBubbles(),this.updateSettingStateBubbles()},100)}updateSettingStateBubbles(){const t=document.querySelectorAll(".setting-bubble[data-setting]"),i=["hints","timer","personalBest","speedTimer","showPoints","sound","animations","petrification","deadPixels","speedMode","wildBlocks"];t.forEach(e=>{const n=e.dataset.setting;let s=!1;if(n==="speedMode"){const o=this.settings.speedMode||"ignored",c={bonus:"üèÉ Bonus",punishment:"‚ö° Punishment",ignored:"üö∂ Ignored"};e.textContent=c[o]||"üö∂ mode",e.classList.remove("state-red","state-green","state-orange"),o==="ignored"?e.classList.add("state-red"):o==="punishment"?e.classList.add("state-orange"):e.classList.add("state-green"),e.classList.add("difficulty-specific"),e.classList.remove("global-setting");return}if(n==="animationSpeed"){const o=this.settings.animationSpeed||"normal",c={slow:"üê¢ Slow",normal:"üé¨ Normal",fast:"üöÄ Fast"};e.textContent=c[o]||"üé¨ speed",e.classList.remove("state-red","state-green","state-orange"),o==="normal"?e.classList.add("state-red"):o==="fast"?e.classList.add("state-orange"):e.classList.add("state-green"),e.classList.add("global-setting"),e.classList.remove("difficulty-specific");return}const d={hints:"enable-hints",timer:"enable-timer",personalBest:"show-personal-bests",speedTimer:"show-speed-timer",sound:"sound-enabled",animations:"animations-enabled",haptic:"haptic-enabled",autoSave:"auto-save",showPoints:"show-points",placementPoints:"show-placement-points",prizeRecognition:"enable-prize-recognition",successMode:"success-mode-enabled",petrification:"enable-petrification",deadPixels:"enable-dead-pixels",wildBlocks:"enable-wild-blocks",blockHover:"block-hover-effects",selectionGlow:"block-selection-glow",blockEntrance:"block-entrance-animations",blockPlacement:"block-placement-animations",lineClear:"line-clear-animations",scoreAnim:"score-animations",combo:"combo-animations",particles:"particle-effects"}[n];if(d){const o=document.getElementById(d);o&&(s=o.checked)}e.classList.remove("state-red","state-green"),e.classList.add(s?"state-green":"state-red"),i.includes(n)?(e.classList.add("difficulty-specific"),e.classList.remove("global-setting")):(e.classList.add("global-setting"),e.classList.remove("difficulty-specific"))})}updateBlockPointsDisplay(){const t=this.settings.showPoints||!1;document.querySelectorAll(".block-info").forEach(e=>{t?e.classList.add("show-points"):e.classList.remove("show-points")})}updateCurrentDifficultyText(){const t=document.getElementById("current-difficulty-text");if(t){const i=this.currentDifficulty.charAt(0).toUpperCase()+this.currentDifficulty.slice(1);t.textContent=`Reset ${i}`}}setupResetListeners(){const t=document.getElementById("reset-current-difficulty");t&&t.addEventListener("click",()=>{const o=this.currentDifficulty.charAt(0).toUpperCase()+this.currentDifficulty.slice(1);this.confirmationDialog.show(`Reset ${o} settings to defaults?`,"This will reset all settings for the current difficulty level to their default values. Your customizations will be lost.",()=>{this.difficultySettings.resetToDefaults(this.currentDifficulty),this.loadSettings(),this.updateUI(),this.showNotification(`Settings reset to defaults for ${o} difficulty`)})});const i=document.getElementById("reset-all-difficulties");i&&i.addEventListener("click",()=>{this.confirmationDialog.show("Reset ALL difficulty settings to defaults?","This will reset all settings for ALL difficulty levels to their default values. All your customizations will be lost.",()=>{this.difficultySettings.resetAllToDefaults(),this.loadSettings(),this.updateUI(),this.showNotification("All difficulty settings reset to defaults")})});const e=document.getElementById("toggle-difficulty-defaults"),n=document.getElementById("difficulty-defaults-table"),s=document.getElementById("toggle-text"),a=document.getElementById("toggle-arrow"),d=document.getElementById("view-difficulty-defaults-link");if(e&&n&&s&&a){const o=()=>{n.style.display!=="none"?(n.style.display="none",s.textContent="üìã Show Defaults by Difficulty",a.style.transform="rotate(0deg)"):(n.style.display="block",s.textContent="üìã Hide Defaults by Difficulty",a.style.transform="rotate(180deg)",this.populateDifficultyDefaultsTable(),setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"center"})},100))};e.addEventListener("click",o),d&&d.addEventListener("click",c=>{c.preventDefault(),n.style.display==="none"?o():n.scrollIntoView({behavior:"smooth",block:"center"})})}}populateDifficultyDefaultsTable(){const t=document.getElementById("defaults-table-body");if(!t)return;t.innerHTML="";const i=[{key:"enableHints",name:"Enable Hints",description:"Show placement suggestions"},{key:"showPoints",name:"Show Block Points",description:"Display point values on blocks"},{key:"enableTimer",name:"Enable Timer",description:"Add time pressure"},{key:"enablePetrification",name:"Enable Petrification",description:"Blocks petrify over time"},{key:"enableDeadPixels",name:"Enable Dead Pixels",description:"Add visual interference"},{key:"showPersonalBests",name:"Show Personal Bests",description:"Display progress in utility bar"},{key:"showSpeedTimer",name:"Show Speed Timer",description:"Track placement speed"},{key:"speedMode",name:"Speed Tracking Mode",description:"How speed affects scoring"},{key:"enablePrizeRecognition",name:"Enable Prize Recognition",description:"Recognize and celebrate achievements"},{key:"pieceTimeoutEnabled",name:"Enable Piece Timeout",description:"Auto-end game when pieces timeout"},{key:"animationsEnabled",name:"Animations",description:"Visual effects and transitions"},{key:"soundEnabled",name:"Sound Effects",description:"Audio feedback"}],e=["easy","normal","hard","expert"];i.forEach(n=>{const s=document.createElement("tr");s.style.borderBottom="1px solid var(--border-color)";const a=document.createElement("td");a.style.padding="0.75rem",a.style.border="1px solid var(--border-color)",a.innerHTML=`
                <div style="font-weight: 600; color: var(--text-color);">${n.name}</div>
                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">${n.description}</div>
            `,s.appendChild(a),e.forEach(d=>{const o=document.createElement("td");o.style.padding="0.75rem",o.style.border="1px solid var(--border-color)",o.style.textAlign="center";const c=this.difficultySettings.difficultyDefaults[d][n.key];let l,u;if(n.key==="speedMode"){const r={bonus:"var(--success-color, #28a745)",punishment:"var(--warning-color, #ff6b35)",ignored:"var(--muted-color, #6c757d)"};l=c.toUpperCase(),u=r[c]||"var(--muted-color, #6c757d)"}else{const r=c===!0;l=r?"ON":"OFF",u=r?"var(--success-color, #28a745)":"var(--muted-color, #6c757d)"}o.innerHTML=`
                    <div style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 4px; font-weight: 600; font-size: 0.8rem; 
                                background: ${u}; 
                                color: white;">
                        ${l}
                    </div>
                `,s.appendChild(o)}),t.appendChild(s)})}setupCrossPageCommunication(){window.addEventListener("storage",t=>{(t.key==="blockdoku-settings"||t.key==="blockdoku_settings")&&(this.loadSettings(),this.updateUI(),this.updateCurrentDifficultyText())}),window.addEventListener("focus",()=>{this.loadSettings(),this.updateUI(),this.updateCurrentDifficultyText()})}isGameInProgress(){var t,i;if(window.opener&&window.opener.game){const e=window.opener.game;return e.score>0||((i=(t=e.blockManager)==null?void 0:t.currentBlocks)==null?void 0:i.length)>0}return!1}resetCurrentGameScore(){if(window.opener&&window.opener.game){const t=window.opener.game;t.score=0,t.level=1,t.scoringSystem&&t.scoringSystem.reset(),t.timerSystem&&(t.timerSystem.reset(),t.timerSystem.initialize(),t.timerSystem.start()),t.updateUI&&t.updateUI()}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.gameSettingsManager=new g}):window.gameSettingsManager=new g;
