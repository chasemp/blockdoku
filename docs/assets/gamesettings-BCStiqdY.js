import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css             *//* empty css             */import{D as I,_ as D}from"./difficulty-settings-manager-BP-zScMF.js";import{G as C,C as x}from"./confirmation-dialog-C0eUIuYP.js";class v{constructor(){this.storage=new C,this.difficultySettings=new I(this.storage),this.settings=this.storage.loadSettings(),this.currentDifficulty=this.settings.difficulty||"normal",this.confirmationDialog=new x,this.init()}init(){this.loadSettings(),this.setupEventListeners(),this.setupResetListeners(),this.setupCrossPageCommunication(),this.updateUI()}loadSettings(){const e=this.storage.loadSettings();this.currentDifficulty=e.difficulty||"normal";const i=this.difficultySettings.getSettingsForDifficulty(this.currentDifficulty);this.settings={...e,...i},this.loadComboDisplaySettings(),this.loadGameModesSettings(),this.loadBasicSettings(),this.loadAdditionalSettings(),this.loadUtilityBarSettings()}loadComboDisplaySettings(){const e=this.settings.comboDisplayMode||"cumulative",i=document.getElementById("combo-streak"),t=document.getElementById("combo-cumulative");i&&t&&(e==="streak"?i.checked=!0:t.checked=!0)}loadGameModesSettings(){const e=document.getElementById("enable-petrification");e&&(e.checked=this.settings.enablePetrification===!0);const i=document.getElementById("enable-dead-pixels"),t=document.getElementById("dead-pixels-intensity"),n=document.getElementById("dead-pixels-intensity-value"),s=document.getElementById("dead-pixels-intensity-container");if(i&&(i.checked=this.settings.enableDeadPixels===!0,s&&(s.style.display=this.settings.enableDeadPixels?"block":"none")),t&&n){const p=this.settings.deadPixelsIntensity||0;t.value=p,n.textContent=p}const o=document.getElementById("enable-magic-blocks"),c=document.getElementById("magic-blocks-frequency"),a=document.getElementById("magic-blocks-frequency-value"),d=document.getElementById("magic-blocks-frequency-percent"),r=document.getElementById("magic-blocks-frequency-container");if(o&&(o.checked=this.settings.enableMagicBlocks===!0,r&&(r.style.display=this.settings.enableMagicBlocks?"block":"none")),c&&a&&d){const p=this.settings.magicBlocksFrequency||1;c.value=p,a.textContent=`${p} in 10`,d.textContent=`${p*10}%`}const l=document.getElementById("auto-rotate-blocks");l&&(l.checked=this.settings.autoRotateBlocks===!0);const m=document.getElementById("enable-wild-shapes"),u=document.getElementById("wild-shapes-frequency"),h=document.getElementById("wild-shapes-frequency-value"),y=document.getElementById("wild-shapes-frequency-percent"),w=document.getElementById("wild-shapes-frequency-container");if(m&&(m.checked=this.settings.enableWildShapes===!0,w&&(w.style.display=this.settings.enableWildShapes?"block":"none")),u&&h&&y){const p=this.settings.wildShapesFrequency||1;u.value=p,h.textContent=`${p} in 10`,y.textContent=`${p*10}%`}this.updateFrequencyOverlapVisualization();const g=this.settings.speedMode||"ignored",f=document.getElementById("speed-mode-bonus"),b=document.getElementById("speed-mode-punishment"),k=document.getElementById("speed-mode-ignored");f&&b&&k&&(g==="punishment"?b.checked=!0:g==="ignored"?k.checked=!0:f.checked=!0);const B=this.settings.speedDisplayMode||"timer",S=document.getElementById("speed-display-timer"),E=document.getElementById("speed-display-points");S&&E&&(B==="points"?E.checked=!0:S.checked=!0)}loadBasicSettings(){const e=document.getElementById("sound-enabled");e&&(e.checked=this.settings.soundEnabled===!0);const i=document.getElementById("piece-timeout-enabled");i&&(i.checked=this.settings.pieceTimeoutEnabled===!0);const t=document.getElementById("enable-block-rotation");t&&(t.checked=this.settings.enableBlockRotation!==!1);const n=document.getElementById("show-rotate-button");n&&(n.checked=this.settings.showRotateButton===!0);const s=document.getElementById("rotate-button-container");s&&t&&(s.style.display=t.checked?"block":"none")}loadAdditionalSettings(){[{id:"auto-save",key:"autoSave"}].forEach(({id:i,key:t})=>{const n=document.getElementById(i);n&&(n.checked=this.settings[t]===!0)})}loadUtilityBarSettings(){[{id:"enable-hints",key:"enableHints"},{id:"enable-timer",key:"enableTimer"},{id:"show-personal-bests",key:"showPersonalBests"},{id:"show-speed-timer",key:"showSpeedTimer"}].forEach(({id:u,key:h})=>{const y=document.getElementById(u);y&&(y.checked=this.settings[h]===!0)});const i=document.getElementById("enable-timer"),t=document.getElementById("countdown-duration"),n=document.getElementById("countdown-duration-value"),s=document.getElementById("countdown-duration-container");if(i&&s&&(s.style.display=this.settings.enableTimer?"block":"none"),t&&n){const u=this.settings.countdownDuration||3;t.value=u,n.textContent=`${u}:00`}const o=document.getElementById("show-speed-timer"),c=document.getElementById("speed-timer-duration"),a=document.getElementById("speed-timer-duration-value"),d=document.getElementById("speed-timer-duration-container");if(o&&d&&(d.style.display=this.settings.showSpeedTimer?"block":"none"),c&&a){const u=this.settings.speedTimerDuration||10;c.value=u,a.textContent=`${u}s`}const r=document.getElementById("speed-timer-precision"),l=document.getElementById("speed-timer-precision-value"),m=document.getElementById("speed-timer-precision-container");if(o&&m&&(m.style.display=this.settings.showSpeedTimer?"block":"none"),r&&l){const u=this.settings.speedTimerPrecision||"seconds";r.value=u,u==="milliseconds"?l.textContent="Milliseconds":u==="high-precision"?l.textContent="High Precision":l.textContent="Seconds"}}setupEventListeners(){this.setupDifficultyListeners(),this.setupComboDisplayListeners(),this.setupGameModesListeners(),this.setupBasicSettingsListeners(),this.setupAdditionalSettingsListeners(),this.setupUtilityBarListeners(),this.setupResetStatisticsListener()}setupDifficultyListeners(){document.querySelectorAll(".difficulty-option").forEach(i=>{i.addEventListener("click",async t=>{t.preventDefault();const n=i.dataset.difficulty;if(n===this.currentDifficulty)return;console.log(`🎮 Game Settings: Changing difficulty to ${n.toUpperCase()}`),this.currentDifficulty=n,this.settings.difficulty=n;const s=this.difficultySettings.getSettingsForDifficulty(n);Object.assign(this.settings,s),this.storage.saveSettings(this.settings),this.updateDifficultySelection(),this.loadSettings(),this.updateUI(),window.postMessage({type:"difficultyChanged",difficulty:n},"*")})})}updateDifficultySelection(){document.querySelectorAll(".difficulty-option").forEach(i=>{const t=i.dataset.difficulty;t===this.currentDifficulty?i.classList.add("selected"):i.classList.remove("selected"),this.updateDifficultyDescription(i,t)})}updateDifficultyDescription(e,i){const t=e.querySelector("p");t&&(this.difficultyManager?this.renderDifficultyWithBubbles(t,i):D(()=>import("./difficulty-manager-BLAdw1T_.js"),[],import.meta.url).then(n=>{const s=n.DifficultyManager;this.difficultyManager=new s,this.renderDifficultyWithBubbles(t,i)}).catch(n=>{console.warn("Could not load difficulty manager for descriptions:",n)}))}renderDifficultyWithBubbles(e,i){const t=this.difficultyManager.difficultySettings[i],n=t?t.shortDescription:"",s=this.difficultyManager.getComparisonBubbles(i,this.difficultySettings);let o=`<span class="difficulty-short-desc">${n}</span>`;s.length>0&&(o+='<div class="difficulty-bubbles">',s.forEach(c=>{const a=c.type==="enabled"?"bubble-enabled":"bubble-disabled";o+=`<span class="difficulty-bubble ${a}">${c.emoji} ${c.label}</span>`}),o+="</div>"),e.innerHTML=o}setupComboDisplayListeners(){const e=document.getElementById("combo-streak"),i=document.getElementById("combo-cumulative");e&&e.addEventListener("change",()=>{e.checked&&this.saveSetting("comboDisplayMode","streak")}),i&&i.addEventListener("change",()=>{i.checked&&this.saveSetting("comboDisplayMode","cumulative")})}setupGameModesListeners(){const e=document.getElementById("enable-petrification");e&&e.addEventListener("change",()=>{this.saveSetting("enablePetrification",e.checked)});const i=document.getElementById("enable-dead-pixels"),t=document.getElementById("dead-pixels-intensity"),n=document.getElementById("dead-pixels-intensity-container");i&&i.addEventListener("change",()=>{this.saveSetting("enableDeadPixels",i.checked),n&&(n.style.display=i.checked?"block":"none")}),t&&t.addEventListener("input",()=>{const g=parseInt(t.value);this.saveSetting("deadPixelsIntensity",g);const f=document.getElementById("dead-pixels-intensity-value");f&&(f.textContent=g)});const s=document.getElementById("enable-magic-blocks"),o=document.getElementById("magic-blocks-frequency"),c=document.getElementById("magic-blocks-frequency-container");s&&s.addEventListener("change",()=>{this.saveSetting("enableMagicBlocks",s.checked),c&&(c.style.display=s.checked?"block":"none"),this.updateFrequencyOverlapVisualization()}),o&&o.addEventListener("input",()=>{const g=parseInt(o.value);this.saveSetting("magicBlocksFrequency",g);const f=document.getElementById("magic-blocks-frequency-value"),b=document.getElementById("magic-blocks-frequency-percent");f&&(f.textContent=`${g} in 10`),b&&(b.textContent=`${g*10}%`),this.updateFrequencyOverlapVisualization()});const a=document.getElementById("auto-rotate-blocks");a&&a.addEventListener("change",()=>{this.saveSetting("autoRotateBlocks",a.checked)});const d=document.getElementById("enable-wild-shapes"),r=document.getElementById("wild-shapes-frequency"),l=document.getElementById("wild-shapes-frequency-container");d&&d.addEventListener("change",()=>{this.saveSetting("enableWildShapes",d.checked),l&&(l.style.display=d.checked?"block":"none"),this.updateFrequencyOverlapVisualization()}),r&&r.addEventListener("input",()=>{const g=parseInt(r.value);this.saveSetting("wildShapesFrequency",g);const f=document.getElementById("wild-shapes-frequency-value"),b=document.getElementById("wild-shapes-frequency-percent");f&&(f.textContent=`${g} in 10`),b&&(b.textContent=`${g*10}%`),this.updateFrequencyOverlapVisualization()});const m=document.getElementById("speed-mode-bonus"),u=document.getElementById("speed-mode-punishment"),h=document.getElementById("speed-mode-ignored");m&&m.addEventListener("change",()=>{m.checked&&this.saveSetting("speedMode","bonus")}),u&&u.addEventListener("change",()=>{u.checked&&this.saveSetting("speedMode","punishment")}),h&&h.addEventListener("change",()=>{h.checked&&this.saveSetting("speedMode","ignored")});const y=document.getElementById("speed-display-timer"),w=document.getElementById("speed-display-points");y&&y.addEventListener("change",()=>{y.checked&&this.saveSetting("speedDisplayMode","timer")}),w&&w.addEventListener("change",()=>{w.checked&&this.saveSetting("speedDisplayMode","points")})}setupBasicSettingsListeners(){const e=document.getElementById("sound-enabled");e&&e.addEventListener("change",()=>{this.saveSetting("soundEnabled",e.checked)});const i=document.getElementById("piece-timeout-enabled");i&&i.addEventListener("change",()=>{this.saveSetting("pieceTimeoutEnabled",i.checked)});const t=document.getElementById("enable-block-rotation"),n=document.getElementById("rotate-button-container");t&&t.addEventListener("change",()=>{this.saveSetting("enableBlockRotation",t.checked),n&&(n.style.display=t.checked?"block":"none");const o=document.getElementById("show-rotate-button");!t.checked&&o&&(o.checked=!1,this.saveSetting("showRotateButton",!1)),window.opener&&window.opener.game&&window.opener.game.blockPalette&&(window.opener.game.blockPalette.updateRotationEnabled(t.checked),window.opener.game.blockPalette.updateRotateButtonVisibility&&window.opener.game.blockPalette.updateRotateButtonVisibility(t.checked&&(o==null?void 0:o.checked)))});const s=document.getElementById("show-rotate-button");s&&s.addEventListener("change",()=>{this.saveSetting("showRotateButton",s.checked),window.opener&&window.opener.game&&window.opener.game.blockPalette&&window.opener.game.blockPalette.updateRotateButtonVisibility(s.checked)})}setupAdditionalSettingsListeners(){[{id:"auto-save",key:"autoSave"}].forEach(({id:i,key:t})=>{const n=document.getElementById(i);n&&n.addEventListener("change",()=>{this.saveSetting(t,n.checked)})})}setupUtilityBarListeners(){[{id:"enable-hints",key:"enableHints"},{id:"enable-timer",key:"enableTimer"},{id:"show-personal-bests",key:"showPersonalBests"},{id:"show-speed-timer",key:"showSpeedTimer"}].forEach(({id:s,key:o})=>{const c=document.getElementById(s);c&&c.addEventListener("change",async()=>{if(s==="enable-timer"){const a=this.settings[o]===!0,d=c.checked;if(a!==d&&this.isGameInProgress()){const l=d?"enabling":"disabling";if(!await this.confirmationDialog.show(`⚠️ Countdown Timer Change

${l==="enabling"?"Enabling":"Disabling"} the countdown timer mid-game will reset your current score to 0.

This ensures fair scoring since the countdown timer affects the game's difficulty and scoring system.

Do you want to continue?`)){c.checked=a;return}this.saveSetting(o,c.checked),this.resetCurrentGameScore()}else if(this.saveSetting(o,c.checked),window.opener&&window.opener.game){const l=window.opener.game;l.timerSystem&&(c.checked?(l.timerSystem.initialize(),l.timerSystem.start()):l.timerSystem.disable()),l.updateTimerDisplay&&l.updateTimerDisplay()}const r=document.getElementById("countdown-duration-container");r&&(r.style.display=c.checked?"block":"none")}else if(s==="show-speed-timer"){const a=this.settings[o]===!0,d=c.checked;if(!a&&d&&this.isGameInProgress()){if(!await this.confirmationDialog.show(`⚠️ Speed Timer Change

Enabling the speed timer mid-game will reset your current score to 0.

This ensures fair scoring since the speed timer affects the game's scoring system and bonus calculations.

Do you want to continue?`)){c.checked=a;return}this.saveSetting(o,c.checked),this.resetCurrentGameScore()}else this.saveSetting(o,c.checked);const r=document.getElementById("speed-timer-duration-container");r&&(r.style.display=c.checked?"block":"none");const l=document.getElementById("speed-timer-precision-container");l&&(l.style.display=c.checked?"block":"none")}else this.saveSetting(o,c.checked)})});const i=document.getElementById("countdown-duration");i&&i.addEventListener("input",async()=>{const s=parseInt(i.value),o=this.settings.countdownDuration||3;if(s!==o&&this.isGameInProgress()&&this.settings.enableTimer){if(!await this.confirmationDialog.show(`⚠️ Countdown Duration Change

Changing the countdown duration mid-game will reset your current score to 0.

This ensures fair scoring since the countdown timer affects the game's difficulty and scoring system.

Do you want to continue?`)){i.value=o;return}this.saveSetting("countdownDuration",s),this.resetCurrentGameScore()}else if(this.saveSetting("countdownDuration",s),window.opener&&window.opener.game&&this.settings.enableTimer){const a=window.opener.game;a.timerSystem&&(a.timerSystem.initialize(),a.timerSystem.start()),a.updateTimerDisplay&&a.updateTimerDisplay()}const c=document.getElementById("countdown-duration-value");c&&(c.textContent=`${s}:00`)});const t=document.getElementById("speed-timer-duration");t&&t.addEventListener("input",async()=>{const s=parseInt(t.value),o=this.settings.speedTimerDuration||10;if(s!==o&&this.isGameInProgress()&&this.settings.showSpeedTimer){if(!await this.confirmationDialog.show(`⚠️ Speed Timer Duration Change

Changing the speed timer duration mid-game will reset your current score to 0.

This ensures fair scoring since the speed timer affects the game's scoring system and bonus calculations.

Do you want to continue?`)){t.value=o;return}this.saveSetting("speedTimerDuration",s),this.resetCurrentGameScore()}else this.saveSetting("speedTimerDuration",s);const c=document.getElementById("speed-timer-duration-value");c&&(c.textContent=`${s}s`)});const n=document.getElementById("speed-timer-precision");n&&n.addEventListener("change",()=>{const s=n.value;this.saveSetting("speedTimerPrecision",s);const o=document.getElementById("speed-timer-precision-value");o&&(s==="milliseconds"?o.textContent="Milliseconds":s==="high-precision"?o.textContent="High Precision":o.textContent="Seconds")})}setupResetStatisticsListener(){const e=document.getElementById("reset-stats");e&&e.addEventListener("click",async()=>{await this.confirmationDialog.show(`⚠️ PERMANENT DATA LOSS WARNING ⚠️

This will permanently delete ALL your game data:
• All high scores for all difficulty levels
• All game statistics (games played, totals, combos)
• All personal best records
• All play time data

Your game settings and preferences will NOT be affected.

This action CANNOT be undone. Are you absolutely sure you want to continue?`)&&this.resetStatistics()})}setupCrossPageCommunication(){window.addEventListener("storage",e=>{(e.key==="blockdoku-settings"||e.key==="blockdoku_settings")&&(console.log("Settings changed in another page, reloading..."),this.settings=this.storage.loadSettings(),this.loadSettings(),this.updateUI())}),window.addEventListener("settingsChanged",e=>{console.log("Settings changed in same page, updating..."),this.settings=this.storage.loadSettings(),this.loadSettings(),this.updateUI()})}saveSetting(e,i){["enableHints","showPoints","enableTimer","enablePetrification","enableDeadPixels","showPersonalBests","showSpeedTimer","speedMode","animationsEnabled","soundEnabled","enableMagicBlocks","enableWildShapes","speedTimerPrecision"].includes(e)?(this.difficultySettings.saveSettingOverride(this.currentDifficulty,e,i),console.log(`Difficulty-specific setting saved: ${e} = ${i} for ${this.currentDifficulty}`)):(this.settings[e]=i,this.storage.saveSettings(this.settings),console.log(`Global setting saved: ${e} = ${i}`)),this.settings[e]=i,window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{key:e,value:i}})),this.updateDifficultyBubbles(),this.updateSettingStateBubbles()}updateDifficultyBubbles(){document.querySelectorAll(".difficulty-option").forEach(i=>{const t=i.dataset.difficulty;this.updateDifficultyDescription(i,t)}),this.updateIndividualSettingBubbles()}updateIndividualSettingBubbles(){document.querySelectorAll(".individual-setting-bubble").forEach(e=>{e.remove()})}getSettingKeyForBubble(e,i){return{Hints:"enableHints",Points:"showPoints",Timer:"enableTimer",Best:"showPersonalBests",Speed:"showSpeedTimer",Prizes:"enablePrizeRecognition",Timeout:"pieceTimeoutEnabled"}[e]}addBubbleToSetting(e,i){const t=e.closest(".setting-item");if(!t)return;const n=document.createElement("div");n.className=`individual-setting-bubble difficulty-bubble ${i.type==="enabled"?"bubble-enabled":"bubble-disabled"}`,n.innerHTML=`${i.emoji} ${i.label}`,n.style.marginBottom="0.5rem",n.style.alignSelf="flex-start",t.insertBefore(n,t.firstChild)}addBubbleToSection(e,i){const t=e.querySelector(".individual-setting-bubble");t&&t.remove();const n=document.createElement("div");n.className=`individual-setting-bubble difficulty-bubble ${i.type==="enabled"?"bubble-enabled":"bubble-disabled"}`,n.innerHTML=`${i.emoji} ${i.label}`,n.style.marginBottom="1rem",n.style.alignSelf="flex-start";const s=e.querySelector("h3");s&&s.insertAdjacentElement("afterend",n)}resetStatistics(){this.storage.clearStatistics(),this.storage.clearHighScores(),this.showNotification("All statistics and high scores have been permanently deleted")}showNotification(e){const i=document.createElement("div");i.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            z-index: 1000;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `,i.textContent=e,document.body.appendChild(i),setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},3e3)}updateUI(){this.loadSettings(),this.updateDifficultySelection(),setTimeout(()=>{this.updateIndividualSettingBubbles(),this.updateSettingStateBubbles(),this.updateFrequencyOverlapVisualization()},100)}updateFrequencyOverlapVisualization(){var e,i;try{const t=((e=document.getElementById("enable-magic-blocks"))==null?void 0:e.checked)||!1,n=((i=document.getElementById("enable-wild-shapes"))==null?void 0:i.checked)||!1,s=document.getElementById("magic-blocks-frequency"),o=document.getElementById("wild-shapes-frequency");if(!s||!o)return;const c=t?parseInt(s.value||"1",10):0,a=n?parseInt(o.value||"1",10):0,d=10,r=n?Math.max(0,d-(t?c:0)):d,l=t?Math.max(0,d-(n?a:0)):d;this.styleSliderOverlap(o,r,a),this.styleSliderOverlap(s,l,c)}catch{}}styleSliderOverlap(e,i,t){if(!e)return;const n=10,s=(m,u,h)=>Math.max(u,Math.min(h,m)),o=s(i/n*100,0,100),c=s(t/n*100,0,100),a="var(--primary-color, #8d6e63)",d="var(--muted-color, #6c757d)",r="var(--border-color, #cccccc)";let l;t<=i?(l=`linear-gradient(to right, ${a} 0% ${c}%, ${r} ${c}% 100%)`,e.title=""):(l=`linear-gradient(to right, ${a} 0% ${o}%, ${d} ${o}% ${c}%, ${r} ${c}% 100%)`,e.title="Overlapping portion will be alternated between types"),e.style.background=l}updateSettingStateBubbles(){const e=document.querySelectorAll(".setting-bubble[data-setting]"),i=["hints","timer","personalBest","speedTimer","showPoints","sound","animations","petrification","deadPixels","speedMode","magicBlocks","autoRotate","wildShapes"];e.forEach(t=>{const n=t.dataset.setting;let s=!1;if(n==="speedMode"){const a=this.settings.speedMode||"ignored",d={bonus:"🏃 Bonus",punishment:"⚡ Punishment",ignored:"🚶 Ignored"};t.textContent=d[a]||"🚶 mode",t.classList.remove("state-red","state-green","state-orange"),a==="ignored"?t.classList.add("state-red"):a==="punishment"?t.classList.add("state-orange"):t.classList.add("state-green"),t.classList.add("difficulty-specific"),t.classList.remove("global-setting");return}if(n==="animationSpeed"){const a=this.settings.animationSpeed||"normal",d={slow:"🐢 Slow",normal:"🎬 Normal",fast:"🚀 Fast"};t.textContent=d[a]||"🎬 speed",t.classList.remove("state-red","state-green","state-orange"),a==="normal"?t.classList.add("state-red"):a==="fast"?t.classList.add("state-orange"):t.classList.add("state-green"),t.classList.add("global-setting"),t.classList.remove("difficulty-specific");return}const c={hints:"enable-hints",timer:"enable-timer",personalBest:"show-personal-bests",speedTimer:"show-speed-timer",sound:"sound-enabled",animations:"animations-enabled",haptic:"haptic-enabled",autoSave:"auto-save",showPoints:"show-points",placementPoints:"show-placement-points",prizeRecognition:"enable-prize-recognition",successMode:"success-mode-enabled",petrification:"enable-petrification",deadPixels:"enable-dead-pixels",magicBlocks:"enable-magic-blocks",autoRotate:"auto-rotate-blocks",wildShapes:"enable-wild-shapes",blockHover:"block-hover-effects",selectionGlow:"block-selection-glow",blockEntrance:"block-entrance-animations",blockPlacement:"block-placement-animations",lineClear:"line-clear-animations",scoreAnim:"score-animations",combo:"combo-animations",particles:"particle-effects"}[n];if(c){const a=document.getElementById(c);a&&(s=a.checked)}t.classList.remove("state-red","state-green"),t.classList.add(s?"state-green":"state-red"),i.includes(n)?(t.classList.add("difficulty-specific"),t.classList.remove("global-setting")):(t.classList.add("global-setting"),t.classList.remove("difficulty-specific"))})}updateBlockPointsDisplay(){const e=this.settings.showPoints||!1;document.querySelectorAll(".block-info").forEach(t=>{e?t.classList.add("show-points"):t.classList.remove("show-points")})}updateCurrentDifficultyText(){const e=document.getElementById("current-difficulty-text");if(e){const i=this.currentDifficulty.charAt(0).toUpperCase()+this.currentDifficulty.slice(1);e.textContent=`Reset ${i}`}}setupResetListeners(){const e=document.getElementById("reset-current-difficulty");e&&e.addEventListener("click",async()=>{const a=this.currentDifficulty.charAt(0).toUpperCase()+this.currentDifficulty.slice(1);await this.confirmationDialog.show(`Reset ${a} settings to defaults?`)&&(this.difficultySettings.resetToDefaults(this.currentDifficulty),this.loadSettings(),this.updateUI(),this.showNotification(`Settings reset to defaults for ${a} difficulty`))});const i=document.getElementById("reset-all-difficulties");i&&i.addEventListener("click",async()=>{await this.confirmationDialog.show("Reset ALL difficulty settings to defaults?")&&(this.difficultySettings.resetAllToDefaults(),this.loadSettings(),this.updateUI(),this.showNotification("All difficulty settings reset to defaults"))});const t=document.getElementById("toggle-difficulty-defaults"),n=document.getElementById("difficulty-defaults-table"),s=document.getElementById("toggle-text"),o=document.getElementById("toggle-arrow"),c=document.getElementById("view-difficulty-defaults-link");if(t&&n&&s&&o){const a=()=>{n.style.display!=="none"?(n.style.display="none",s.textContent="📋 Show Defaults by Difficulty",o.style.transform="rotate(0deg)"):(n.style.display="block",s.textContent="📋 Hide Defaults by Difficulty",o.style.transform="rotate(180deg)",this.populateDifficultyDefaultsTable(),setTimeout(()=>{n.scrollIntoView({behavior:"smooth",block:"center"})},100))};t.addEventListener("click",a),c&&c.addEventListener("click",d=>{d.preventDefault(),n.style.display==="none"?a():n.scrollIntoView({behavior:"smooth",block:"center"})})}}populateDifficultyDefaultsTable(){const e=document.getElementById("defaults-table-body");if(!e)return;e.innerHTML="";const i=[{key:"enableHints",name:"Enable Hints",description:"Show placement suggestions"},{key:"showPoints",name:"Show Block Points",description:"Display point values on blocks"},{key:"enableTimer",name:"Enable Timer",description:"Add time pressure"},{key:"enablePetrification",name:"Enable Petrification",description:"Blocks petrify over time"},{key:"enableDeadPixels",name:"Enable Dead Pixels",description:"Add visual interference"},{key:"showPersonalBests",name:"Show Personal Bests",description:"Display progress in utility bar"},{key:"showSpeedTimer",name:"Show Speed Timer",description:"Track placement speed"},{key:"speedMode",name:"Speed Tracking Mode",description:"How speed affects scoring"},{key:"enablePrizeRecognition",name:"Enable Prize Recognition",description:"Recognize and celebrate achievements"},{key:"pieceTimeoutEnabled",name:"Enable Piece Timeout",description:"Auto-end game when pieces timeout"},{key:"animationsEnabled",name:"Animations",description:"Visual effects and transitions"},{key:"soundEnabled",name:"Sound Effects",description:"Audio feedback"}],t=["easy","normal","hard","expert"];i.forEach(n=>{const s=document.createElement("tr");s.style.borderBottom="1px solid var(--border-color)";const o=document.createElement("td");o.style.padding="0.75rem",o.style.border="1px solid var(--border-color)",o.innerHTML=`
                <div style="font-weight: 600; color: var(--text-color);">${n.name}</div>
                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">${n.description}</div>
            `,s.appendChild(o),t.forEach(c=>{const a=document.createElement("td");a.style.padding="0.75rem",a.style.border="1px solid var(--border-color)",a.style.textAlign="center";const d=this.difficultySettings.difficultyDefaults[c][n.key];let r,l;if(n.key==="speedMode"){const m={bonus:"var(--success-color, #28a745)",punishment:"var(--warning-color, #ff6b35)",ignored:"var(--muted-color, #6c757d)"};r=d.toUpperCase(),l=m[d]||"var(--muted-color, #6c757d)"}else{const m=d===!0;r=m?"ON":"OFF",l=m?"var(--success-color, #28a745)":"var(--muted-color, #6c757d)"}a.innerHTML=`
                    <div style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 4px; font-weight: 600; font-size: 0.8rem; 
                                background: ${l}; 
                                color: white;">
                        ${r}
                    </div>
                `,s.appendChild(a)}),e.appendChild(s)})}setupCrossPageCommunication(){window.addEventListener("storage",e=>{(e.key==="blockdoku-settings"||e.key==="blockdoku_settings")&&(this.loadSettings(),this.updateUI(),this.updateCurrentDifficultyText())}),window.addEventListener("focus",()=>{this.loadSettings(),this.updateUI(),this.updateCurrentDifficultyText()})}isGameInProgress(){var e,i;if(window.opener&&window.opener.game){const t=window.opener.game;return t.score>0||((i=(e=t.blockManager)==null?void 0:e.currentBlocks)==null?void 0:i.length)>0}return!1}resetCurrentGameScore(){if(window.opener&&window.opener.game){const e=window.opener.game;e.loadSettings&&e.loadSettings(),e.score=0,e.level=1,e.firstPiecePlaced=!1,e.scoringSystem&&e.scoringSystem.reset(),e.timerSystem&&(e.timerSystem.reset(),e.timerSystem.initialize(),e.timerSystem.isActive?console.log("⏱️ Countdown timer will start on next piece placement"):console.log("⏱️ Countdown timer disabled")),e.updateUI&&e.updateUI(),e.updateTimerDisplay&&e.updateTimerDisplay(),e.updateUtilityBarLayout&&e.updateUtilityBarLayout()}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.gameSettingsManager=new v}):window.gameSettingsManager=new v;
