import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css             *//* empty css             */import{D as g,_ as h}from"./difficulty-settings-manager-D2MsyMLE.js";import{G as y,C as p}from"./confirmation-dialog-Bfw5TIb9.js";class m{constructor(){this.storage=new y,this.difficultySettings=new g(this.storage),this.settings=this.storage.loadSettings(),this.currentDifficulty=this.settings.difficulty||"normal",this.confirmationDialog=new p,this.init()}init(){this.loadSettings(),this.setupEventListeners(),this.setupResetListeners(),this.setupCrossPageCommunication(),this.updateUI()}loadSettings(){const t=this.storage.loadSettings();this.currentDifficulty=t.difficulty||"normal";const e=this.difficultySettings.getSettingsForDifficulty(this.currentDifficulty);this.settings={...t,...e},this.loadComboDisplaySettings(),this.loadGameModesSettings(),this.loadBasicSettings(),this.loadAnimationSettings(),this.loadAdditionalSettings(),this.loadUtilityBarSettings()}loadComboDisplaySettings(){const t=this.settings.comboDisplayMode||"cumulative",e=document.getElementById("combo-streak"),s=document.getElementById("combo-cumulative");e&&s&&(t==="streak"?e.checked=!0:s.checked=!0)}loadGameModesSettings(){const t=document.getElementById("enable-petrification");t&&(t.checked=this.settings.enablePetrification===!0);const e=document.getElementById("enable-dead-pixels"),s=document.getElementById("dead-pixels-intensity"),i=document.getElementById("dead-pixels-intensity-value"),n=document.getElementById("dead-pixels-intensity-container");if(e&&(e.checked=this.settings.enableDeadPixels===!0,n&&(n.style.display=this.settings.enableDeadPixels?"block":"none")),s&&i){const f=this.settings.deadPixelsIntensity||0;s.value=f,i.textContent=f}const o=this.settings.speedMode||"bonus",d=document.getElementById("speed-mode-bonus"),a=document.getElementById("speed-mode-punishment"),l=document.getElementById("speed-mode-ignored");d&&a&&l&&(o==="punishment"?a.checked=!0:o==="ignored"?l.checked=!0:d.checked=!0);const r=this.settings.speedDisplayMode||"timer",c=document.getElementById("speed-display-timer"),u=document.getElementById("speed-display-points");c&&u&&(r==="points"?u.checked=!0:c.checked=!0)}loadBasicSettings(){const t=document.getElementById("sound-enabled");t&&(t.checked=this.settings.soundEnabled===!0);const e=document.getElementById("animations-enabled");e&&(e.checked=this.settings.animationsEnabled!==!1);const s=document.getElementById("piece-timeout-enabled");s&&(s.checked=this.settings.pieceTimeoutEnabled===!0)}loadAnimationSettings(){["block-hover-effects","block-selection-glow","block-entrance-animations","block-placement-animations","line-clear-animations","score-animations","combo-animations","particle-effects"].forEach(i=>{const n=document.getElementById(i);n&&(n.checked=this.settings[i]!==!1)});const e=this.settings.animationSpeed||"normal",s=document.getElementById(`animation-speed-${e}`);s&&(s.checked=!0)}loadAdditionalSettings(){[{id:"haptic-enabled",key:"hapticEnabled"},{id:"auto-save",key:"autoSave"},{id:"show-points",key:"showPoints"},{id:"show-placement-points",key:"showPlacementPoints"},{id:"enable-prize-recognition",key:"enablePrizeRecognition"},{id:"success-mode-enabled",key:"successModeEnabled"}].forEach(({id:e,key:s})=>{const i=document.getElementById(e);i&&(i.checked=this.settings[s]===!0)})}loadUtilityBarSettings(){[{id:"enable-hints",key:"enableHints"},{id:"enable-timer",key:"enableTimer"},{id:"show-personal-bests",key:"showPersonalBests"},{id:"show-speed-timer",key:"showSpeedTimer"}].forEach(({id:e,key:s})=>{const i=document.getElementById(e);i&&(i.checked=this.settings[s]===!0)})}setupEventListeners(){this.setupDifficultyListeners(),this.setupComboDisplayListeners(),this.setupGameModesListeners(),this.setupBasicSettingsListeners(),this.setupAnimationListeners(),this.setupAdditionalSettingsListeners(),this.setupUtilityBarListeners(),this.setupResetStatisticsListener()}setupDifficultyListeners(){document.querySelectorAll(".difficulty-option").forEach(e=>{e.addEventListener("click",async s=>{var a;s.preventDefault();const i=e.dataset.difficulty;if(i===this.currentDifficulty)return;const n=localStorage.getItem(((a=this.storage)==null?void 0:a.storageKey)||"blockdoku_game_data");let o=!1;if(n)try{const l=JSON.parse(n);o=l.score>0||l.board.some(r=>r.some(c=>c===1))}catch{o=!1}if(o&&!await this.confirmationDialog.show(`Changing difficulty to ${i.toUpperCase()} will reset your current game and you'll lose your progress. Are you sure you want to continue?`,"Confirm Difficulty Change"))return;console.log(`ðŸŽ® Game Settings: Changing difficulty to ${i.toUpperCase()}`),this.currentDifficulty=i,this.settings.difficulty=i;const d=this.difficultySettings.getSettingsForDifficulty(i);Object.assign(this.settings,d),this.storage.saveSettings(this.settings),this.updateDifficultySelection(),this.loadSettings(),this.updateUI(),setTimeout(()=>{this.updateIndividualSettingBubbles()},150),window.postMessage({type:"difficultyChanged",difficulty:i},"*")})})}updateDifficultySelection(){document.querySelectorAll(".difficulty-option").forEach(e=>{const s=e.dataset.difficulty;s===this.currentDifficulty?e.classList.add("selected"):e.classList.remove("selected"),this.updateDifficultyDescription(e,s)})}updateDifficultyDescription(t,e){const s=t.querySelector("p");s&&(this.difficultyManager?this.renderDifficultyWithBubbles(s,e):h(()=>import("./difficulty-manager-D-G7WLk3.js"),[],import.meta.url).then(i=>{const n=i.DifficultyManager;this.difficultyManager=new n,this.renderDifficultyWithBubbles(s,e)}).catch(i=>{console.warn("Could not load difficulty manager for descriptions:",i)}))}renderDifficultyWithBubbles(t,e){const s=this.difficultyManager.difficultySettings[e],i=s?s.shortDescription:"",n=this.difficultyManager.getComparisonBubbles(e,this.difficultySettings);let o=`<span class="difficulty-short-desc">${i}</span>`;n.length>0&&(o+='<div class="difficulty-bubbles">',n.forEach(d=>{const a=d.type==="enabled"?"bubble-enabled":"bubble-disabled";o+=`<span class="difficulty-bubble ${a}">${d.emoji} ${d.label}</span>`}),o+="</div>"),t.innerHTML=o}setupComboDisplayListeners(){const t=document.getElementById("combo-streak"),e=document.getElementById("combo-cumulative");t&&t.addEventListener("change",()=>{t.checked&&this.saveSetting("comboDisplayMode","streak")}),e&&e.addEventListener("change",()=>{e.checked&&this.saveSetting("comboDisplayMode","cumulative")})}setupGameModesListeners(){const t=document.getElementById("enable-petrification");t&&t.addEventListener("change",()=>{this.saveSetting("enablePetrification",t.checked)});const e=document.getElementById("enable-dead-pixels"),s=document.getElementById("dead-pixels-intensity"),i=document.getElementById("dead-pixels-intensity-container");e&&e.addEventListener("change",()=>{this.saveSetting("enableDeadPixels",e.checked),i&&(i.style.display=e.checked?"block":"none")}),s&&s.addEventListener("input",()=>{const r=parseInt(s.value);this.saveSetting("deadPixelsIntensity",r);const c=document.getElementById("dead-pixels-intensity-value");c&&(c.textContent=r)});const n=document.getElementById("speed-mode-bonus"),o=document.getElementById("speed-mode-punishment"),d=document.getElementById("speed-mode-ignored");n&&n.addEventListener("change",()=>{n.checked&&this.saveSetting("speedMode","bonus")}),o&&o.addEventListener("change",()=>{o.checked&&this.saveSetting("speedMode","punishment")}),d&&d.addEventListener("change",()=>{d.checked&&this.saveSetting("speedMode","ignored")});const a=document.getElementById("speed-display-timer"),l=document.getElementById("speed-display-points");a&&a.addEventListener("change",()=>{a.checked&&this.saveSetting("speedDisplayMode","timer")}),l&&l.addEventListener("change",()=>{l.checked&&this.saveSetting("speedDisplayMode","points")})}setupBasicSettingsListeners(){const t=document.getElementById("sound-enabled");t&&t.addEventListener("change",()=>{this.saveSetting("soundEnabled",t.checked)});const e=document.getElementById("animations-enabled");e&&e.addEventListener("change",()=>{this.saveSetting("animationsEnabled",e.checked)});const s=document.getElementById("piece-timeout-enabled");s&&s.addEventListener("change",()=>{this.saveSetting("pieceTimeoutEnabled",s.checked)})}setupAnimationListeners(){["block-hover-effects","block-selection-glow","block-entrance-animations","block-placement-animations","line-clear-animations","score-animations","combo-animations","particle-effects"].forEach(s=>{const i=document.getElementById(s);i&&i.addEventListener("change",()=>{this.saveSetting(s,i.checked)})}),document.querySelectorAll('input[name="animation-speed"]').forEach(s=>{s.addEventListener("change",()=>{s.checked&&this.saveSetting("animationSpeed",s.value)})})}setupAdditionalSettingsListeners(){[{id:"haptic-enabled",key:"hapticEnabled"},{id:"auto-save",key:"autoSave"},{id:"show-points",key:"showPoints"},{id:"show-placement-points",key:"showPlacementPoints"},{id:"enable-prize-recognition",key:"enablePrizeRecognition"},{id:"success-mode-enabled",key:"successModeEnabled"}].forEach(({id:e,key:s})=>{const i=document.getElementById(e);i&&i.addEventListener("change",()=>{this.saveSetting(s,i.checked),e==="show-points"&&this.updateBlockPointsDisplay()})})}setupUtilityBarListeners(){[{id:"enable-hints",key:"enableHints"},{id:"enable-timer",key:"enableTimer"},{id:"show-personal-bests",key:"showPersonalBests"},{id:"show-speed-timer",key:"showSpeedTimer"}].forEach(({id:e,key:s})=>{const i=document.getElementById(e);i&&i.addEventListener("change",()=>{this.saveSetting(s,i.checked)})})}setupResetStatisticsListener(){const t=document.getElementById("reset-stats");t&&t.addEventListener("click",async()=>{await this.confirmationDialog.show(`âš ï¸ PERMANENT DATA LOSS WARNING âš ï¸

This will permanently delete ALL your game data:
â€¢ All high scores for all difficulty levels
â€¢ All game statistics (games played, totals, combos)
â€¢ All personal best records
â€¢ All play time data

Your game settings and preferences will NOT be affected.

This action CANNOT be undone. Are you absolutely sure you want to continue?`)&&this.resetStatistics()})}setupCrossPageCommunication(){window.addEventListener("storage",t=>{(t.key==="blockdoku-settings"||t.key==="blockdoku_settings")&&(console.log("Settings changed in another page, reloading..."),this.settings=this.storage.loadSettings(),this.loadSettings(),this.updateUI())}),window.addEventListener("settingsChanged",t=>{console.log("Settings changed in same page, updating..."),this.settings=this.storage.loadSettings(),this.loadSettings(),this.updateUI()})}saveSetting(t,e){["enableHints","showPoints","enableTimer","enablePetrification","enableDeadPixels","showPersonalBests","showSpeedTimer","speedMode","animationsEnabled","soundEnabled"].includes(t)?(this.difficultySettings.saveSettingOverride(this.currentDifficulty,t,e),console.log(`Difficulty-specific setting saved: ${t} = ${e} for ${this.currentDifficulty}`)):(this.settings[t]=e,this.storage.saveSettings(this.settings),console.log(`Global setting saved: ${t} = ${e}`)),this.settings[t]=e,window.dispatchEvent(new CustomEvent("settingsChanged",{detail:{key:t,value:e}})),this.updateDifficultyBubbles()}updateDifficultyBubbles(){document.querySelectorAll(".difficulty-option").forEach(e=>{const s=e.dataset.difficulty;this.updateDifficultyDescription(e,s)}),this.updateIndividualSettingBubbles()}updateIndividualSettingBubbles(){if(!this.difficultyManager)return;const t=this.difficultyManager.getComparisonBubbles(this.currentDifficulty,this.difficultySettings),e={enableHints:"enable-hints",showPoints:"show-points",enableTimer:"enable-timer",showPersonalBests:"show-personal-bests",showSpeedTimer:"show-speed-timer",enablePrizeRecognition:"enable-prize-recognition",pieceTimeoutEnabled:"piece-timeout-enabled"};document.querySelectorAll(".individual-setting-bubble").forEach(i=>{i.remove()}),Object.entries(e).forEach(([i,n])=>{const o=document.getElementById(n);if(!o)return;const d=t.find(a=>this.getSettingKeyForBubble(a.label,a.emoji)===i);d&&this.addBubbleToSetting(o,d)});const s=t.find(i=>i.emoji==="ðŸƒ");if(s){const i=document.querySelector("#speed-tracking-settings");i&&this.addBubbleToSection(i,s)}}getSettingKeyForBubble(t,e){return{Hints:"enableHints",Points:"showPoints",Timer:"enableTimer",Best:"showPersonalBests",Speed:"showSpeedTimer",Prizes:"enablePrizeRecognition",Timeout:"pieceTimeoutEnabled"}[t]}addBubbleToSetting(t,e){const s=t.closest(".setting-item");if(!s)return;const i=document.createElement("div");i.className=`individual-setting-bubble difficulty-bubble ${e.type==="enabled"?"bubble-enabled":"bubble-disabled"}`,i.innerHTML=`${e.emoji} ${e.label}`,i.style.marginBottom="0.5rem",i.style.alignSelf="flex-start",s.insertBefore(i,s.firstChild)}addBubbleToSection(t,e){const s=t.querySelector(".individual-setting-bubble");s&&s.remove();const i=document.createElement("div");i.className=`individual-setting-bubble difficulty-bubble ${e.type==="enabled"?"bubble-enabled":"bubble-disabled"}`,i.innerHTML=`${e.emoji} ${e.label}`,i.style.marginBottom="1rem",i.style.alignSelf="flex-start";const n=t.querySelector("h3");n&&n.insertAdjacentElement("afterend",i)}resetStatistics(){this.storage.clearStatistics(),this.storage.clearHighScores(),this.showNotification("All statistics and high scores have been permanently deleted")}showNotification(t){const e=document.createElement("div");e.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            z-index: 1000;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `,e.textContent=t,document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},3e3)}updateUI(){this.loadSettings(),this.updateDifficultySelection(),setTimeout(()=>{this.updateIndividualSettingBubbles()},100)}updateBlockPointsDisplay(){const t=this.settings.showPoints||!1;document.querySelectorAll(".block-info").forEach(s=>{t?s.classList.add("show-points"):s.classList.remove("show-points")})}updateCurrentDifficultyText(){const t=document.getElementById("current-difficulty-text");if(t){const e=this.currentDifficulty.charAt(0).toUpperCase()+this.currentDifficulty.slice(1);t.textContent=`Reset ${e}`}}setupResetListeners(){const t=document.getElementById("reset-current-difficulty");t&&t.addEventListener("click",()=>{const a=this.currentDifficulty.charAt(0).toUpperCase()+this.currentDifficulty.slice(1);this.confirmationDialog.show(`Reset ${a} settings to defaults?`,"This will reset all settings for the current difficulty level to their default values. Your customizations will be lost.",()=>{this.difficultySettings.resetToDefaults(this.currentDifficulty),this.loadSettings(),this.updateUI(),this.showNotification(`Settings reset to defaults for ${a} difficulty`)})});const e=document.getElementById("reset-all-difficulties");e&&e.addEventListener("click",()=>{this.confirmationDialog.show("Reset ALL difficulty settings to defaults?","This will reset all settings for ALL difficulty levels to their default values. All your customizations will be lost.",()=>{this.difficultySettings.resetAllToDefaults(),this.loadSettings(),this.updateUI(),this.showNotification("All difficulty settings reset to defaults")})});const s=document.getElementById("toggle-difficulty-defaults"),i=document.getElementById("difficulty-defaults-table"),n=document.getElementById("toggle-text"),o=document.getElementById("toggle-arrow"),d=document.getElementById("view-difficulty-defaults-link");if(s&&i&&n&&o){const a=()=>{i.style.display!=="none"?(i.style.display="none",n.textContent="ðŸ“‹ Show Defaults by Difficulty",o.style.transform="rotate(0deg)"):(i.style.display="block",n.textContent="ðŸ“‹ Hide Defaults by Difficulty",o.style.transform="rotate(180deg)",this.populateDifficultyDefaultsTable(),setTimeout(()=>{i.scrollIntoView({behavior:"smooth",block:"center"})},100))};s.addEventListener("click",a),d&&d.addEventListener("click",l=>{l.preventDefault(),i.style.display==="none"?a():i.scrollIntoView({behavior:"smooth",block:"center"})})}}populateDifficultyDefaultsTable(){const t=document.getElementById("defaults-table-body");if(!t)return;t.innerHTML="";const e=[{key:"enableHints",name:"Enable Hints",description:"Show placement suggestions"},{key:"showPoints",name:"Show Block Points",description:"Display point values on blocks"},{key:"enableTimer",name:"Enable Timer",description:"Add time pressure"},{key:"enablePetrification",name:"Enable Petrification",description:"Blocks petrify over time"},{key:"enableDeadPixels",name:"Enable Dead Pixels",description:"Add visual interference"},{key:"showPersonalBests",name:"Show Personal Bests",description:"Display progress in utility bar"},{key:"showSpeedTimer",name:"Show Speed Timer",description:"Track placement speed"},{key:"speedMode",name:"Speed Tracking Mode",description:"How speed affects scoring"},{key:"enablePrizeRecognition",name:"Enable Prize Recognition",description:"Recognize and celebrate achievements"},{key:"pieceTimeoutEnabled",name:"Enable Piece Timeout",description:"Auto-end game when pieces timeout"},{key:"animationsEnabled",name:"Animations",description:"Visual effects and transitions"},{key:"soundEnabled",name:"Sound Effects",description:"Audio feedback"}],s=["easy","normal","hard","expert"];e.forEach(i=>{const n=document.createElement("tr");n.style.borderBottom="1px solid var(--border-color)";const o=document.createElement("td");o.style.padding="0.75rem",o.style.border="1px solid var(--border-color)",o.innerHTML=`
                <div style="font-weight: 600; color: var(--text-color);">${i.name}</div>
                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">${i.description}</div>
            `,n.appendChild(o),s.forEach(d=>{const a=document.createElement("td");a.style.padding="0.75rem",a.style.border="1px solid var(--border-color)",a.style.textAlign="center";const l=this.difficultySettings.difficultyDefaults[d][i.key];let r,c;if(i.key==="speedMode"){const u={bonus:"var(--success-color, #28a745)",punishment:"var(--warning-color, #ff6b35)",ignored:"var(--muted-color, #6c757d)"};r=l.toUpperCase(),c=u[l]||"var(--muted-color, #6c757d)"}else{const u=l===!0;r=u?"ON":"OFF",c=u?"var(--success-color, #28a745)":"var(--muted-color, #6c757d)"}a.innerHTML=`
                    <div style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 4px; font-weight: 600; font-size: 0.8rem; 
                                background: ${c}; 
                                color: white;">
                        ${r}
                    </div>
                `,n.appendChild(a)}),t.appendChild(n)})}setupCrossPageCommunication(){window.addEventListener("storage",t=>{(t.key==="blockdoku-settings"||t.key==="blockdoku_settings")&&(this.loadSettings(),this.updateUI(),this.updateCurrentDifficultyText())}),window.addEventListener("focus",()=>{this.loadSettings(),this.updateUI(),this.updateCurrentDifficultyText()})}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.gameSettingsManager=new m}):window.gameSettingsManager=new m;
