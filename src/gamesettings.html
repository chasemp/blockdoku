<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Settings - Blockdoku</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/themes/wood.css" id="theme-css">
    <link rel="stylesheet" href="../css/themes/light.css" id="theme-css-light" media="not all">
    <link rel="stylesheet" href="../css/themes/dark.css" id="theme-css-dark" media="not all">
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <link rel="manifest" href="../manifest.json">
    <meta name="theme-color" content="#8B4513">
    <script>
        // Function to update theme
        function updateTheme() {
            const savedSettings = localStorage.getItem('blockdoku_settings') || localStorage.getItem('blockdoku-settings');
            let theme = 'wood'; // Default to wood theme
            
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    if (settings.theme) {
                        theme = settings.theme;
                    }
                } catch (e) {
                    console.log('Error parsing settings:', e);
                }
            }
            
            // Check if theme is already correctly applied to avoid redundant updates
            const currentThemeLink = document.getElementById('theme-css');
            const currentTheme = currentThemeLink ? currentThemeLink.href : '';
            const expectedThemeUrl = `../css/themes/${theme}.css`;
            
            if (currentTheme.includes(expectedThemeUrl)) {
                // Theme is already correctly applied, just ensure other themes are disabled
                const lightLink = document.getElementById('theme-css-light');
                const darkLink = document.getElementById('theme-css-dark');
                
                if (lightLink) lightLink.disabled = true;
                if (darkLink) darkLink.disabled = true;
                
                // Set data-theme attribute for CSS selectors
                document.documentElement.setAttribute('data-theme', theme);
                document.body.className = document.body.className.replace(/light-theme|dark-theme|wood-theme/g, '');
                document.body.classList.add(`${theme}-theme`);
                return;
            }
            
            // Apply the theme
            let themeLink = document.getElementById('theme-css');
            if (!themeLink) {
                themeLink = document.createElement('link');
                themeLink.rel = 'stylesheet';
                themeLink.id = 'theme-css';
                document.head.appendChild(themeLink);
            }
            const themeUrl = `../css/themes/${theme}.css`;
            console.log('Client-side theme update:', theme);
            themeLink.href = themeUrl;
            
            // Disable other theme CSS files
            const lightLink = document.getElementById('theme-css-light');
            const darkLink = document.getElementById('theme-css-dark');
            
            if (lightLink) {
                lightLink.disabled = true;
            }
            if (darkLink) {
                darkLink.disabled = true;
            }

            // If Vite injected a wood stylesheet into built HTML, disable it when switching away
            try {
                const builtWoodLinks = Array.from(document.querySelectorAll('link[rel="stylesheet"]'))
                    .filter(l => (l.getAttribute('href') || '').includes('/assets/wood-') || (l.href || '').includes('/assets/wood-'));
                builtWoodLinks.forEach(l => {
                    l.disabled = theme !== 'wood';
                });
            } catch (e) {}
            
            // Set data-theme attribute for CSS selectors
            document.documentElement.setAttribute('data-theme', theme);
            
            // Add theme class to body
            document.body.className = document.body.className.replace(/light-theme|dark-theme|wood-theme/g, '');
            document.body.classList.add(`${theme}-theme`);
        }
        
        // Load current theme from localStorage on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Add a small delay to ensure everything is loaded
            setTimeout(updateTheme, 100);
        });
        
        // Listen for theme changes from other pages
        window.addEventListener('storage', function(e) {
            if (e.key === 'blockdoku-settings' || e.key === 'blockdoku_settings') {
                updateTheme();
            }
        });
        
        // Also listen for focus events (when returning from main page)
        window.addEventListener('focus', function() {
            updateTheme();
        });
    </script>
    <meta name="description" content="Blockdoku - A modern take on the classic block puzzle game">
    <meta name="keywords" content="blockdoku, puzzle, game, blocks, tetris, mobile, pwa">
    <meta name="author" content="Chase Pettet">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://blockdoku.523.life/">
    <meta property="og:title" content="Blockdoku - Block Puzzle Game">
    <meta property="og:description" content="A modern take on the classic block puzzle game. Play anywhere, anytime!">
    <meta property="og:image" content="https://blockdoku.523.life/icons/icon-512x512.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://blockdoku.523.life/">
    <meta property="twitter:title" content="Blockdoku - Block Puzzle Game">
    <meta property="twitter:description" content="A modern take on the classic block puzzle game. Play anywhere, anytime!">
    <meta property="twitter:image" content="https://blockdoku.523.life/icons/icon-512x512.png">
</head>
<body>
    <div class="settings-container">
        <header class="settings-header">
            <h1 style="text-align: center;">Game Settings</h1>
            <p>Customize your Blockdoku gameplay experience</p>
        </header>
        
        <!-- Navigation Buttons -->
        <div class="navigation-buttons" style="margin-bottom: 2rem;">
            <a href="../settings.html" class="back-button">
                ← Settings
            </a>
            <a href="../index.html" class="back-button">
                Game →
            </a>
        </div>
        
        <div class="settings-content">
                <!-- Combo Display Settings -->
            <div class="combo-display-settings settings-section-container">
                    <h3>Combo Display</h3>
                    <p class="setting-description" style="margin-bottom: 1rem; margin-left: 0;">Choose how combo points are displayed during gameplay</p>
                    <div class="combo-options">
                        <label class="combo-option">
                            <input type="radio" name="combo-display-mode" value="streak" id="combo-streak" />
                            <span class="combo-label">Streak</span>
                            <span class="combo-description">Show current streak count</span>
                        </label>
                        <label class="combo-option">
                            <input type="radio" name="combo-display-mode" value="cumulative" id="combo-cumulative" checked />
                            <span class="combo-label">Cumulative</span>
                            <span class="combo-description">Show total combo points earned</span>
                        </label>
                    </div>
                </div>
                
            <!-- Utility Bar Settings: Controls 4 optional items in the utility bar (hints, timer, personal best, speed timer) -->
            <div class="utility-bar-settings settings-section-container">
                <h3 style="margin: 1.5rem 0 1rem 0; color: var(--text-color); font-size: 1.1rem; text-align: center;">Utility Bar</h3>
                <p class="setting-description" style="margin-bottom: 1rem; margin-left: 0; text-align: center;">Configure what appears in the utility bar during gameplay (4 potential items: hints, timer, personal best, speed timer)</p>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="enable-hints" />
                            Enable hints
                        </label>
                        <p class="setting-description">Show placement suggestions for blocks when you're stuck</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="enable-timer" />
                            Enable timer
                        </label>
                        <p class="setting-description">Add time pressure to increase difficulty and excitement</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="show-personal-bests" />
                            Enable Personal Best
                            </label>
                        <p class="setting-description">Display your personal best score for the current difficulty level in the utility bar</p>
                </div>
                
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="show-speed-timer" />
                            Enable Speed Timer
                        </label>
                        <p class="setting-description">Display speed timer in the utility bar when speed mode is active</p>
                    </div>
                </div>
                
            <!-- Basic Game Settings -->
            <div class="basic-game-settings settings-section-container">
                    <h3 style="text-align: center;">Basics</h3>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="sound-enabled" />
                        Sound effects
                    </label>
                    <p class="setting-description">Play audio feedback for game actions and events</p>
                </div>
                <div class="setting-item">
                    <label>
                        <input type="checkbox" id="animations-enabled" />
                        Master animations
                    </label>
                    <p class="setting-description">Enable smooth transitions and visual effects during gameplay</p>
                </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="haptic-enabled" />
                            Haptic feedback
                        </label>
                        <p class="setting-description">Vibrate device for tactile feedback on supported devices</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="auto-save" />
                            Auto-save game
                        </label>
                        <p class="setting-description">Automatically save your progress so you can resume later</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="show-points" />
                            Show block points
                        </label>
                        <p class="setting-description">Display point values on each block to help with scoring strategy</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="show-placement-points" />
                            Show placement points
                        </label>
                        <p class="setting-description">Show floating point notifications when placing blocks (can be noisy if enabled)</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="enable-prize-recognition" checked />
                            Enable prize recognition
                        </label>
                        <p class="setting-description">Automatically detect and highlight special prize patterns for bonus points</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="success-mode-enabled" />
                            Enable success mode
                        </label>
                        <p class="setting-description">Show enhanced success animations and effects when achieving combos</p>
                    </div>
                </div>
                
            <!-- Game Modes Section -->
            <div class="game-modes-settings settings-section-container">
                    <h3>Game Modes</h3>
                    <p class="setting-description" style="margin-bottom: 1rem; margin-left: 0;">Enable special game modes that add unique challenges and mechanics. Multiple modes can be active simultaneously!</p>
                    
                    <!-- Petrification Mode -->
                    <div class="setting-item game-mode-item">
                        <label>
                            <input type="checkbox" id="enable-petrification" />
                            Enable petrification
                        </label>
                        <p class="setting-description">Grid cells petrify after 10s and blocks after 30s in place. Petrified cells can't be cleared until a clear event happens. Adds strategic time pressure!</p>
                    </div>
                    
                    <!-- Dead Pixels Mode -->
                    <div class="setting-item game-mode-item">
                        <label>
                            <input type="checkbox" id="enable-dead-pixels" />
                            Enable dead pixels
                        </label>
                        <p class="setting-description">Add "dead" pixels to the board that cannot be used for block placement, like a broken screen. Toggle on/off anytime!</p>
                    </div>
                    <div class="setting-item" id="dead-pixels-intensity-container" style="margin-left: 2rem; display: none;">
                        <label for="dead-pixels-intensity">Dead Pixels Intensity: <span id="dead-pixels-intensity-value">0</span></label>
                        <input type="range" id="dead-pixels-intensity" min="0" max="5" value="0" step="1" style="width: 100%; max-width: 300px; margin-top: 0.5rem;" />
                        <p class="setting-description" style="font-size: 0.85rem; margin-top: 0.5rem;">0 = Off, 5 = Maximum dead pixels (~15-20)</p>
                    </div>
                </div>
                
            <!-- Speed Tracking Mode Section -->
            <div class="speed-tracking-mode-settings settings-section-container">
                    <h3>Speed Tracking</h3>
                    <p class="setting-description" style="margin-bottom: 1rem; margin-left: 0;">Choose how placement speed affects your score</p>
                    <div class="speed-mode-options">
                        <label class="speed-mode-option">
                            <input type="radio" name="speed-mode" value="bonus" id="speed-mode-bonus" checked />
                            <span class="speed-mode-label">
                                <strong>Bonus</strong>
                                <small>Faster = more points.<br>Earn bonus points for quick placements.</small>
                            </span>
                        </label>
                        <label class="speed-mode-option">
                            <input type="radio" name="speed-mode" value="punishment" id="speed-mode-punishment" />
                            <span class="speed-mode-label">
                                <strong>Punishment</strong>
                                <small>Slower = less points.<br>Any second past 1 second subtracts a point per second down to 0.</small>
                            </span>
                        </label>
                        <label class="speed-mode-option">
                            <input type="radio" name="speed-mode" value="ignored" id="speed-mode-ignored" />
                            <span class="speed-mode-label">
                                <strong>Ignored</strong>
                                <small>Speed doesn't affect score.<br>Play at your own pace.</small>
                            </span>
                        </label>
                    </div>
                </div>
                
            <!-- Enhanced Animation Controls -->
            <div class="animation-settings settings-section-container" id="animation-settings">
                    <h3 style="text-align: center;">Enhanced Animation Controls</h3>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="block-hover-effects" />
                            Block hover effects
                        </label>
                        <p class="setting-description">Highlight blocks when you move your cursor over them</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="block-selection-glow" />
                            Block selection glow
                        </label>
                        <p class="setting-description">Add a glowing outline to the currently selected block</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="block-entrance-animations" />
                            Block entrance animations
                        </label>
                        <p class="setting-description">Animate new blocks sliding in when they appear</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="block-placement-animations" />
                            Block placement animations
                        </label>
                        <p class="setting-description">Smooth transition when placing blocks on the grid</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="line-clear-animations" />
                            Line clear animations
                        </label>
                        <p class="setting-description">Visual effects when rows or columns are cleared</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="score-animations" />
                            Score animations
                        </label>
                        <p class="setting-description">Animate score changes and point notifications</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="combo-animations" />
                            Combo animations
                        </label>
                        <p class="setting-description">Special effects when achieving combo multipliers</p>
                    </div>
                    
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="particle-effects" />
                            Particle effects
                        </label>
                        <p class="setting-description">Show particle effects when clearing lines and achieving combos</p>
                    </div>
                    
                    <div class="setting-item">
                        <label for="animation-speed">Animation speed:</label>
                        <select id="animation-speed" style="margin-left: 0.5rem; padding: 0.25rem; border-radius: 4px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color);">
                            <option value="slow">Slow</option>
                            <option value="normal" selected>Normal</option>
                            <option value="fast">Fast</option>
                        </select>
                    </div>
                </div>
                
        
        <!-- Difficulty Selector Section -->
        <div class="difficulty-selector-section settings-section-container">
            <h3>Difficulty Level</h3>
            <p class="setting-description" style="margin-bottom: 1.5rem; margin-left: 0; text-align: center;">Choose your preferred difficulty level. Each level has different default settings.</p>
            <div class="difficulty-options">
                <button class="difficulty-option" data-difficulty="easy">
                    <div class="difficulty-header">
                        <h4>Easy</h4>
                        <span class="difficulty-badge easy">EASY</span>
                    </div>
                    <p>Larger blocks, slower pace, hints available</p>
                </button>
                <button class="difficulty-option" data-difficulty="normal">
                    <div class="difficulty-header">
                        <h4>Normal</h4>
                        <span class="difficulty-badge normal">NORMAL</span>
                    </div>
                    <p>Standard block variety, moderate pace</p>
                </button>
                <button class="difficulty-option" data-difficulty="hard">
                    <div class="difficulty-header">
                        <h4>Hard</h4>
                        <span class="difficulty-badge hard">HARD</span>
                    </div>
                    <p>Smaller blocks, faster pace, no hints</p>
                </button>
                <button class="difficulty-option" data-difficulty="expert">
                    <div class="difficulty-header">
                        <h4>Expert</h4>
                        <span class="difficulty-badge expert">EXPERT</span>
                    </div>
                    <p>Complex shapes, time pressure, limited moves</p>
                </button>
            </div>
        </div>
        
        <!-- Difficulty Defaults Section -->
        <div class="difficulty-defaults-section">
            <h3>Difficulty Defaults</h3>
            <p class="setting-description" style="margin-bottom: 1rem; margin-left: 0;">Reset difficulty defaults for current or all levels.</p>
            
            <div class="reset-buttons-container">
                <button id="reset-current-difficulty" class="reset-button">
                    <span id="current-difficulty-text">Reset</span>
                </button>
                <button id="reset-all-difficulties" class="reset-button">
                    Reset All
                    </button>
                </div>
                
            <!-- Toggle for difficulty defaults table -->
            <div class="toggle-container">
                <button id="toggle-difficulty-defaults" class="toggle-button">
                    <span id="toggle-text">📋 Show Defaults by Difficulty</span>
                    <span id="toggle-arrow" class="toggle-arrow">▼</span>
                    </button>
                </div>
            
            <!-- Difficulty defaults table -->
            <div id="difficulty-defaults-table" class="difficulty-defaults-table" style="display: none;">
                <h4>Default Settings by Difficulty Level</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Setting</th>
                            <th>Easy</th>
                            <th>Normal</th>
                            <th>Hard</th>
                            <th>Expert</th>
                        </tr>
                    </thead>
                    <tbody id="defaults-table-body">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Bottom Navigation Buttons -->
        <div class="navigation-buttons" style="margin-top: 2rem;">
            <a href="../settings.html" class="back-button">
                ← Settings
            </a>
            <a href="../index.html" class="back-button">
                Game →
            </a>
        </div>
        
    </div>
    
    <!-- Copyright Notice -->
    <div class="copyright-notice">
        <p>&copy; Chase Pettet, <a href="http://523.life" target="_blank" rel="noopener noreferrer">523.life</a></p>
    </div>

    <!-- Scripts -->
    <script type="module" src="../js/game-settings.js"></script>
    <script type="module" src="../js/pwa/install.js"></script>
</body>
</html>
