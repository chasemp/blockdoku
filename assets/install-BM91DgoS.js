(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();class i{constructor(){this.storageKey="blockdoku_game_data",this.settingsKey="blockdoku_settings",this.highScoresKey="blockdoku_high_scores",this.maxHighScores=10}saveGameState(t){try{const e={board:t.board,score:t.score,level:t.level,currentBlocks:t.currentBlocks,selectedBlock:t.selectedBlock,timestamp:Date.now()};return localStorage.setItem(this.storageKey,JSON.stringify(e)),!0}catch(e){return console.error("Failed to save game state:",e),!1}}loadGameState(){try{const t=localStorage.getItem(this.storageKey);if(t){const e=JSON.parse(t),o=24*60*60*1e3;if(Date.now()-e.timestamp<o)return e;this.clearGameState()}return null}catch(t){return console.error("Failed to load game state:",t),null}}clearGameState(){try{return localStorage.removeItem(this.storageKey),!0}catch(t){return console.error("Failed to clear game state:",t),!1}}saveHighScore(t){try{const e=this.getHighScores(),o={score:t.score,level:t.level,linesCleared:t.linesCleared,combo:t.combo,maxCombo:t.maxCombo,timestamp:Date.now(),date:new Date().toLocaleDateString()};return e.push(o),e.sort((s,r)=>r.score-s.score),e.splice(this.maxHighScores),localStorage.setItem(this.highScoresKey,JSON.stringify(e)),!0}catch(e){return console.error("Failed to save high score:",e),!1}}getHighScores(){try{const t=localStorage.getItem(this.highScoresKey);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load high scores:",t),[]}}isHighScore(t){var o;const e=this.getHighScores();return e.length<this.maxHighScores||t>((o=e[e.length-1])==null?void 0:o.score)}saveSettings(t){try{return localStorage.setItem(this.settingsKey,JSON.stringify(t)),!0}catch(e){return console.error("Failed to save settings:",e),!1}}loadSettings(){try{const t=localStorage.getItem(this.settingsKey);return t?JSON.parse(t):this.getDefaultSettings()}catch(t){return console.error("Failed to load settings:",t),this.getDefaultSettings()}}getDefaultSettings(){return{theme:"wood",soundEnabled:!0,animationsEnabled:!0,difficulty:"normal",autoSave:!0,enableHints:!1,enableTimer:!1,enableUndo:!1,showPoints:!1}}saveStatistics(t){try{const e="blockdoku_statistics",o=this.loadStatistics(),s={gamesPlayed:(o.gamesPlayed||0)+1,totalScore:(o.totalScore||0)+t.score,totalLinesCleared:(o.totalLinesCleared||0)+t.linesCleared,maxCombo:Math.max(o.maxCombo||0,t.maxCombo),bestScore:Math.max(o.bestScore||0,t.score),lastPlayed:Date.now()};return localStorage.setItem(e,JSON.stringify(s)),!0}catch(e){return console.error("Failed to save statistics:",e),!1}}loadStatistics(){try{const t=localStorage.getItem("blockdoku_statistics");return t?JSON.parse(t):{gamesPlayed:0,totalScore:0,totalLinesCleared:0,maxCombo:0,bestScore:0,lastPlayed:null}}catch(t){return console.error("Failed to load statistics:",t),{gamesPlayed:0,totalScore:0,totalLinesCleared:0,maxCombo:0,bestScore:0,lastPlayed:null}}}clearAllData(){try{return localStorage.removeItem(this.storageKey),localStorage.removeItem(this.settingsKey),localStorage.removeItem(this.highScoresKey),localStorage.removeItem("blockdoku_statistics"),!0}catch(t){return console.error("Failed to clear all data:",t),!1}}getStorageSize(){try{let t=0;for(let e in localStorage)e.startsWith("blockdoku_")&&(t+=localStorage[e].length);return t}catch(t){return console.error("Failed to calculate storage size:",t),0}}exportData(){try{const t={gameState:this.loadGameState(),settings:this.loadSettings(),highScores:this.getHighScores(),statistics:this.loadStatistics(),exportDate:new Date().toISOString(),version:"1.0.0"};return JSON.stringify(t,null,2)}catch(t){return console.error("Failed to export data:",t),null}}importData(t){try{const e=JSON.parse(t);return e.gameState&&this.saveGameState(e.gameState),e.settings&&this.saveSettings(e.settings),e.highScores&&localStorage.setItem(this.highScoresKey,JSON.stringify(e.highScores)),e.statistics&&localStorage.setItem("blockdoku_statistics",JSON.stringify(e.statistics)),!0}catch(e){return console.error("Failed to import data:",e),!1}}}class l{constructor(){this.deferredPrompt=null,this.isInstalled=!1,this.installButton=null,this.init()}init(){this.setupEventListeners(),this.checkInstallStatus(),this.createInstallButton()}setupEventListeners(){window.addEventListener("beforeinstallprompt",t=>{console.log("PWA: beforeinstallprompt event fired"),t.preventDefault(),this.deferredPrompt=t,this.createInstallButton(),this.showInstallButton()}),window.addEventListener("appinstalled",()=>{console.log("PWA: App was installed"),this.isInstalled=!0,this.hideInstallButton(),this.deferredPrompt=null}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("controllerchange",()=>{console.log("PWA: Service worker updated"),this.showUpdateNotification()})}checkInstallStatus(){window.matchMedia("(display-mode: standalone)").matches&&(this.isInstalled=!0,console.log("PWA: App is running in standalone mode")),window.navigator.standalone===!0&&(this.isInstalled=!0,console.log("PWA: App is installed on iOS"))}createInstallButton(){if(document.getElementById("install-button")){this.installButton=document.getElementById("install-button");return}this.installButton=document.createElement("button"),this.installButton.id="install-button",this.installButton.className="btn btn-primary install-btn",this.installButton.innerHTML="ðŸ“± Install App",this.installButton.style.display="none";let t=document.getElementById("install-button-container");if(!t){const e=document.querySelector(".controls");e&&(t=e)}t&&t.appendChild(this.installButton),this.installButton.addEventListener("click",()=>{this.installApp()})}showInstallButton(){this.installButton&&!this.isInstalled&&(this.installButton.style.display="inline-block",this.installButton.classList.add("show"))}hideInstallButton(){this.installButton&&(this.installButton.style.display="none",this.installButton.classList.remove("show"))}async installApp(){if(!this.deferredPrompt){this.showManualInstallInstructions();return}try{this.deferredPrompt.prompt();const{outcome:t}=await this.deferredPrompt.userChoice;console.log(t==="accepted"?"PWA: User accepted the install prompt":"PWA: User dismissed the install prompt"),this.deferredPrompt=null}catch(t){console.error("PWA: Error during installation",t)}}showManualInstallInstructions(){const t=this.getManualInstallInstructions();alert(t)}getManualInstallInstructions(){const t=navigator.userAgent.toLowerCase();return t.includes("chrome")?`To install this app:
1. Click the three dots menu (â‹®) in your browser
2. Select "Install Blockdoku" or "Add to Home screen"`:t.includes("firefox")?`To install this app:
1. Click the three lines menu (â˜°) in your browser
2. Select "Install" or "Add to Home screen"`:t.includes("safari")?`To install this app:
1. Tap the Share button (â–¡â†—) in Safari
2. Select "Add to Home Screen"`:t.includes("edge")?`To install this app:
1. Click the three dots menu (â‹¯) in your browser
2. Select "Apps" then "Install this site as an app"`:'To install this app, look for an "Install" or "Add to Home Screen" option in your browser menu.'}showUpdateNotification(){const t=document.createElement("div");t.className="update-notification",t.innerHTML=`
            <div class="update-content">
                <span>ðŸ”„ App Update Available</span>
                <button class="btn btn-sm" onclick="window.location.reload()">Update Now</button>
            </div>
        `,t.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        `;const e=document.createElement("style");e.textContent=`
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `,document.head.appendChild(e),document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},1e4)}isPWASupported(){return"serviceWorker"in navigator&&"PushManager"in window}getStatus(){return{isInstalled:this.isInstalled,canInstall:!!this.deferredPrompt,isPWASupported:this.isPWASupported(),isOnline:navigator.onLine}}}const c=Object.freeze(Object.defineProperty({__proto__:null,PWAInstallManager:l},Symbol.toStringTag,{value:"Module"}));export{i as G,l as P,c as i};
